<table {{- range $k, $v := .Attributes }}
{{- if $v }}
  {{- printf " %s=%q" $k $v | safeHTMLAttr }}
{{- end }}
{{- end }}>

<thead>
    {{- range .THead }}
      <tr>
        {{- range . }}
          <th
            {{- with .Alignment }}
              {{- printf " style=%q" (printf "text-align: %s" .) | safeHTMLAttr }}
            {{- end -}}
          >
            {{- .Text -}}
          </th>
        {{- end }}
      </tr>
    {{- end }}
  </thead>
  <tbody>
    {{- $TBody := .TBody }}
    {{- $rowCount := len .TBody }}
    {{- $colCount := len (index .TBody 0) }}
    {{- range $rowIndex, $row := .TBody }}
    
      <tr>
        {{- range $colIndex, $col :=  $row }}
        {{- if ne $col.Text "^" }}
        <td
            
            {{- with $col.Alignment }}
              {{- printf " style=%q" (printf "text-align: %s" .) | safeHTMLAttr }}
            {{- end -}}

            {{ $nextRowIndex := add $rowIndex 1 }}
            {{ $nextRow := index $.TBody $nextRowIndex }}
            {{ $nextCol := index $nextRow $colIndex }}
            {{ $rowspan := 1 }}
            {{- if eq $nextCol.Text "^" }}
              {{- $rowspan = add $rowspan 1 -}}
              {{ $newRowIndex := add $nextRowIndex 1 }}
              {{ $afterCount := sub $rowCount $newRowIndex }}
              {{ range after $afterCount $TBody }}
                {{ $tcol := index . $colIndex }}
                {{- if eq $tcol.Text "^" }}
                    {{- $rowspan = add $rowspan 1 -}}
                {{ else }}
                    {{- break -}}
                {{ end }}
              {{ end }}
            {{ end }}
            rowspan="{{ $rowspan }}"
          >
            {{- $col.Text -}}
            {{ $rowIndex }}|{{ $colIndex }}

          </td>
        {{- end }}
          
        {{- end }}
      </tr>
    {{- end }}
  </tbody>
</table>

<div>
{{ .TBody }}
</div>